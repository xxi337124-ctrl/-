generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model article_fetches {
  id            String     @id
  keyword       String
  searchType    String     @default("keyword")
  articles      String
  totalArticles Int
  createdAt     DateTime   @default(now())
  insights      insights[]
}

model articles {
  id        String      @id
  title     String
  content   String
  status    String      @default("DRAFT")
  wordCount Int         @default(0)
  tags      String
  images    String
  insightId String?
  createdAt DateTime    @default(now())
  updatedAt DateTime
  insights  insights?   @relation(fields: [insightId], references: [id])
  publishes publishes[]
}

model creation_tasks {
  id              String   @id
  insightId       String?
  topicIndexes    String
  length          String
  style           String
  platform        String
  imageStrategy   String
  status          String   @default("PENDING")
  progress        Int      @default(0)
  progressMessage String?
  articleId       String?
  error           String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime
}

model insights {
  id                     String           @id
  fetchId                String?
  keyword                String
  searchType             String           @default("keyword")
  totalArticles          Int
  topLikedArticles       String
  topInteractiveArticles String
  wordCloud              String
  insights               String
  articleSummaries       String?
  structuredInsights     String?
  analysisMetadata       String?
  createdAt              DateTime         @default(now())
  viewCount              Int              @default(1)
  isFavorite             Boolean          @default(false)
  lastViewedAt           DateTime         @default(now())
  articles               articles[]
  article_fetches        article_fetches? @relation(fields: [fetchId], references: [id])
}

model prompt_settings {
  id                    String   @id
  userId                String   @unique @default("default")
  textPrompt            String   @default("以专业但易懂的方式撰写，结合实际案例，语言自然流畅")
  wechatTextPrompt      String   @default("以专业正式的方式撰写，结构清晰，段落分明，适合深度阅读。使用数据和案例支撑观点，语言严谨但不失亲和力。")
  xiaohongshuTextPrompt String   @default("以轻松活泼的方式撰写，多用表情符号和网络用语，句子简短有力，适合快速浏览。强调实用性和分享价值，语言贴近年轻群体。")
  insightPrompt         String   @default("深入分析文章主题和趋势，提炼核心观点，识别用户痛点和需求。提供3-5个具有实操价值的选题建议，每个建议包含目标受众、内容角度和推荐标题。")
  imagePrompt           String   @default("扁平插画风格，配色温暖明亮，现代简约，专业质感")
  imageStyle            String   @default("modern-flat")
  strength              Float    @default(0.5)
  imageAnalysisPrompt   String   @default("请仔细分析这张图片，并提供详细的描述和适合 Imagen 3 图片生成的英文提示词。请以 JSON 格式返回：{ \"description\": \"图片描述\", \"suggestedPrompt\": \"英文提示词\", \"keyElements\": [\"元素列表\"], \"style\": \"风格\", \"mood\": \"氛围\" }")
  imageModel            String   @default("gpt-4o-image")
  imagePositivePrompt   String   @default("(masterpiece:1.2), best quality, ultra-detailed, 8k, professional photography, sharp focus, intricate details, cinematic lighting, vibrant colors, physically-based rendering")
  imageNegativePrompt   String   @default("(worst quality, low quality, normal quality:1.4), ugly, deformed, blurry, jpeg artifacts, noisy, watermark, text, signature, username, canvas frame, out of frame, cropped, disfigured, mutated hands, extra limbs, extra fingers")
  denoisingStrength     Float    @default(0.35)
  cfgScale              Float    @default(7.5)
  samplerName           String   @default("DPM++ 2M Karras")
  steps                 Int      @default(25)
  seed                  Int      @default(-1)
  createdAt             DateTime @default(now())
  updatedAt             DateTime
}

model publishes {
  id          String   @id
  articleId   String
  platform    String
  publishedAt DateTime @default(now())
  result      String
  articles    articles @relation(fields: [articleId], references: [id], onDelete: Cascade)
}
