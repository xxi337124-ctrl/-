# å°çº¢ä¹¦äºŒåˆ›æµç¨‹ - æ›´æ–°è¯´æ˜

## âœ… å·²å®Œæˆçš„æ›´æ–°

### 1. ç¯å¢ƒå˜é‡é…ç½®

å·²åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®å¥½æ‰€æœ‰å¿…è¦çš„ API Keysï¼š

```env
# OpenAI Compatible API (ç”¨äºAIç”Ÿæˆ - æ–‡æ¡ˆç›¸å…³)
OPENAI_API_KEY="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"
OPENAI_API_BASE="https://openrouter.ai/api/v1"
OPENAI_MODEL="google/gemini-2.5-pro"

# Google Gemini API (ç”¨äºå›¾ç‰‡åˆ†æ - ä½¿ç”¨ Gemini 2.5 Pro Vision)
GEMINI_API_KEY="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"
GEMINI_API_BASE="https://openrouter.ai/api/v1"
GEMINI_MODEL="google/gemini-2.5-pro"

# Google Gemini Image API (ç”¨äºå›¾ç‰‡ç”Ÿæˆ - ä½¿ç”¨ Gemini 2.5 Flash Image)
GEMINI_IMAGE_API_KEY="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"
GEMINI_IMAGE_API_BASE="https://openrouter.ai/api/v1"
GEMINI_IMAGE_MODEL="google/gemini-2.5-flash-image"
```

### 2. Gemini å®¢æˆ·ç«¯æ›´æ–°

**æ–‡ä»¶**: `src/lib/gemini-client.ts`

**ä¸»è¦å˜æ›´**:
- âœ… ç§»é™¤äº† Google GenerativeAI SDK ä¾èµ–
- âœ… æ”¹ç”¨ OpenRouter API è°ƒç”¨ Gemini æ¨¡å‹
- âœ… æ”¯æŒä¸‰ä¸ªç‹¬ç«‹çš„ API Key é…ç½®
- âœ… æ–‡æ¡ˆä¼˜åŒ–ä½¿ç”¨ `google/gemini-2.5-pro`
- âœ… å›¾ç‰‡åˆ†æä½¿ç”¨ `google/gemini-2.5-pro` (vision)
- âœ… å›¾ç‰‡ç”Ÿæˆä½¿ç”¨ `google/gemini-2.5-flash-image`

**æ ¸å¿ƒåŠŸèƒ½**:
```typescript
// 1. æ–‡æ¡ˆäºŒåˆ›
await geminiClient.optimizeContent(content, {
  platform: 'xiaohongshu',
  style: 'è½»æ¾æ´»æ³¼'
});

// 2. å›¾ç‰‡åˆ†æ
await geminiClient.analyzeImage(imageUrl, customPrompt);

// 3. æ‰¹é‡å›¾ç‰‡åˆ†æ
await geminiClient.analyzeImages(imageUrls, customPrompt);
```

### 3. å®Œæ•´çš„ä¸‰æ­¥æµç¨‹

#### æµç¨‹ 1: æ–‡æ¡ˆäºŒåˆ›
- ä½¿ç”¨ Gemini 2.5 Pro
- é€šè¿‡ OpenRouter API è°ƒç”¨
- API Key: `GEMINI_API_KEY`

#### æµç¨‹ 2: å›¾ç‰‡åˆ†æ
- ä½¿ç”¨ Gemini 2.5 Pro Vision
- é€šè¿‡ OpenRouter API è°ƒç”¨
- API Key: `GEMINI_API_KEY`
- æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰åˆ†ææç¤ºè¯ï¼ˆåœ¨è®¾ç½®ä¸­é…ç½®ï¼‰

#### æµç¨‹ 3: å›¾ç‰‡ç”Ÿæˆ
- ä½¿ç”¨ Imagen 3 (é€šè¿‡ apicore.ai)
- ä½¿ç”¨ Gemini åˆ†æè¿”å›çš„æç¤ºè¯
- ç»“åˆåŸå›¾è¿›è¡Œå›¾ç”Ÿå›¾

### 4. æ•°æ®åº“æ›´æ–°

- âœ… æ·»åŠ äº† `imageAnalysisPrompt` å­—æ®µ
- âœ… æ•°æ®åº“å·²é€šè¿‡ `prisma db push` åŒæ­¥
- âœ… API å·²æ›´æ–°æ”¯æŒæ–°å­—æ®µ

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³• 1: é€šè¿‡å°çº¢ä¹¦å¤„ç†å™¨ä½¿ç”¨

```typescript
import { xiaohongshuProcessor } from '@/lib/xiaohongshu-processor';

const result = await xiaohongshuProcessor.processPost(post, {
  // æ–‡æ¡ˆäºŒåˆ›
  optimizeContent: true,           // ä½¿ç”¨ Gemini 2.5 Pro ä¼˜åŒ–æ–‡æ¡ˆ

  // å›¾ç‰‡åˆ†æ
  useGeminiForAnalysis: true,      // ä½¿ç”¨ Gemini 2.5 Pro åˆ†æå›¾ç‰‡

  // å›¾ç‰‡ç”Ÿæˆ
  useImagenForGeneration: true,    // ä½¿ç”¨ Imagen 3 ç”Ÿæˆæ–°å›¾ç‰‡

  variationCount: 3,               // æ¯å¼ å›¾ç”Ÿæˆ3ä¸ªå˜ä½“
  targetPlatform: 'xiaohongshu',   // ç›®æ ‡å¹³å°
});

// ç»“æœ
console.log(result.optimizedContent);  // äºŒåˆ›åçš„æ–‡æ¡ˆ
console.log(result.generatedImages);   // ç”Ÿæˆçš„å›¾ç‰‡
```

### æ–¹æ³• 2: ç›´æ¥ä½¿ç”¨ Gemini å®¢æˆ·ç«¯

```typescript
import { geminiClient } from '@/lib/gemini-client';

// æ–‡æ¡ˆä¼˜åŒ–
const optimizedText = await geminiClient.optimizeContent(
  "åŸå§‹æ–‡æ¡ˆ",
  { platform: 'xiaohongshu', style: 'è½»æ¾æ´»æ³¼' }
);

// å›¾ç‰‡åˆ†æ
const analysis = await geminiClient.analyzeImage(
  'https://example.com/image.jpg',
  customPrompt  // å¯é€‰ï¼šè‡ªå®šä¹‰åˆ†ææç¤ºè¯
);

console.log(analysis.suggestedPrompt);  // ç”¨äº Imagen 3 çš„è‹±æ–‡æç¤ºè¯
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### è‡ªå®šä¹‰å›¾ç‰‡åˆ†ææç¤ºè¯

1. è¿›å…¥åº”ç”¨çš„è®¾ç½®é¡µé¢
2. æ‰¾åˆ°"å›¾ç‰‡åˆ†ææç¤ºè¯"é…ç½®é¡¹
3. ç¼–è¾‘æç¤ºè¯æ¨¡æ¿ï¼ˆä¾‹å¦‚ï¼‰:

```
è¯·è¯¦ç»†åˆ†æè¿™å¼ å›¾ç‰‡ï¼Œé‡ç‚¹æè¿°ï¼š
1. ä¸»ä½“å†…å®¹å’Œæ„å›¾
2. è‰²å½©å’Œå…‰çº¿
3. é£æ ¼å’Œæ°›å›´

è¿”å› JSON æ ¼å¼ï¼š
{
  "description": "è¯¦ç»†çš„ä¸­æ–‡æè¿°",
  "suggestedPrompt": "é€‚åˆ Imagen 3 çš„è‹±æ–‡æç¤ºè¯",
  "keyElements": ["å…³é”®å…ƒç´ åˆ—è¡¨"],
  "style": "å›¾ç‰‡é£æ ¼",
  "mood": "æ°›å›´"
}
```

### API Key è¯´æ˜

| ç”¨é€” | API Key | æ¨¡å‹ |
|------|---------|------|
| æ–‡æ¡ˆäºŒåˆ› | GEMINI_API_KEY | google/gemini-2.5-pro |
| å›¾ç‰‡åˆ†æ | GEMINI_API_KEY | google/gemini-2.5-pro |
| å›¾ç‰‡ç”Ÿæˆ | APICORE_API_KEY | Imagen 3 via apicore.ai |

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### OpenRouter é›†æˆ

æ‰€æœ‰ Gemini è°ƒç”¨éƒ½é€šè¿‡ OpenRouter API è¿›è¡Œï¼š

**ä¼˜ç‚¹**:
- âœ… ç»Ÿä¸€çš„ API æ¥å£
- âœ… æ›´å¥½çš„é€Ÿç‡é™åˆ¶ç®¡ç†
- âœ… æ”¯æŒå¤šç§æ¨¡å‹åˆ‡æ¢
- âœ… è¯¦ç»†çš„ä½¿ç”¨ç»Ÿè®¡

**API æ ¼å¼**:
```typescript
// æ–‡æœ¬ç”Ÿæˆ
POST https://openrouter.ai/api/v1/chat/completions
{
  "model": "google/gemini-2.5-pro",
  "messages": [{ "role": "user", "content": "..." }]
}

// å›¾ç‰‡åˆ†æ (vision)
POST https://openrouter.ai/api/v1/chat/completions
{
  "model": "google/gemini-2.5-pro",
  "messages": [{
    "role": "user",
    "content": [
      { "type": "text", "text": "..." },
      { "type": "image_url", "image_url": { "url": "..." }}
    ]
  }]
}
```

### é”™è¯¯å¤„ç†

æ‰€æœ‰ API è°ƒç”¨éƒ½åŒ…å«å®Œå–„çš„é”™è¯¯å¤„ç†ï¼š
- âœ… è‡ªåŠ¨é‡è¯•ï¼ˆæœ€å¤š3æ¬¡ï¼‰
- âœ… æŒ‡æ•°é€€é¿ç­–ç•¥
- âœ… é™çº§å¤„ç†
- âœ… è¯¦ç»†çš„æ—¥å¿—è®°å½•

---

## ğŸ“Š æµç¨‹å¯¹æ¯”

### ä¹‹å‰çš„æµç¨‹
```
åŸå§‹æ–‡æ¡ˆ â†’ (æ— äºŒåˆ›) â†’ åŸå§‹å›¾ç‰‡ â†’ (ç®€å•å¤„ç†) â†’ ç”Ÿæˆå›¾ç‰‡
```

### ç°åœ¨çš„æµç¨‹
```
åŸå§‹æ–‡æ¡ˆ â†’ Gemini 2.5 Pro æ–‡æ¡ˆä¼˜åŒ– â†’ ä¼˜åŒ–åçš„æ–‡æ¡ˆ
            â†“
åŸå§‹å›¾ç‰‡ â†’ Gemini 2.5 Pro å›¾ç‰‡åˆ†æ â†’ è‹±æ–‡æç¤ºè¯
            â†“
è‹±æ–‡æç¤ºè¯ + åŸå›¾ â†’ Imagen 3 å›¾ç”Ÿå›¾ â†’ æ–°ç”Ÿæˆçš„å›¾ç‰‡
```

---

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•

- [x] ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
- [x] Gemini å®¢æˆ·ç«¯æ›´æ–°å®Œæˆ
- [x] æ•°æ®åº“ schema æ›´æ–°
- [x] API è·¯ç”±æ›´æ–°
- [x] å°çº¢ä¹¦å¤„ç†å™¨é›†æˆæ–°æµç¨‹
- [x] TypeScript ç±»å‹é”™è¯¯ä¿®å¤
- [ ] è¿è¡Œå®Œæ•´æµç¨‹æµ‹è¯•
- [ ] éªŒè¯æ–‡æ¡ˆäºŒåˆ›æ•ˆæœ
- [ ] éªŒè¯å›¾ç‰‡åˆ†ææ•ˆæœ
- [ ] éªŒè¯å›¾ç‰‡ç”Ÿæˆæ•ˆæœ

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **æµ‹è¯•æ–‡æ¡ˆäºŒåˆ›**
   ```bash
   # è°ƒç”¨ API æµ‹è¯•
   POST /api/xiaohongshu-enhanced
   ```

2. **æµ‹è¯•å›¾ç‰‡åˆ†æ**
   ```bash
   # å•ç‹¬æµ‹è¯• Gemini å›¾ç‰‡åˆ†æ
   ```

3. **æµ‹è¯•å®Œæ•´æµç¨‹**
   ```bash
   # ä½¿ç”¨çœŸå®çš„å°çº¢ä¹¦æ•°æ®æµ‹è¯•
   ```

4. **ä¼˜åŒ–æç¤ºè¯**
   - æ ¹æ®å®é™…æ•ˆæœè°ƒæ•´å›¾ç‰‡åˆ†ææç¤ºè¯
   - ä¼˜åŒ–æ–‡æ¡ˆäºŒåˆ›çš„é£æ ¼æ¨¡æ¿

---

## ğŸ› å·²çŸ¥é—®é¢˜å’Œä¿®å¤

### é—®é¢˜ 1: Google Generative AI SDK ä¾èµ–
**çŠ¶æ€**: âœ… å·²ä¿®å¤
**æ–¹æ¡ˆ**: æ”¹ç”¨ OpenRouter APIï¼Œç§»é™¤ SDK ä¾èµ–

### é—®é¢˜ 2: TypeScript ç±»å‹é”™è¯¯
**çŠ¶æ€**: âœ… å·²ä¿®å¤
**æ–¹æ¡ˆ**: æ·»åŠ æ˜ç¡®çš„æ³›å‹ç±»å‹å£°æ˜

### é—®é¢˜ 3: æ•°æ®åº“ schema æ¼‚ç§»
**çŠ¶æ€**: âœ… å·²ä¿®å¤
**æ–¹æ¡ˆ**: ä½¿ç”¨ `prisma db push` ç›´æ¥åŒæ­¥ schema

---

## ğŸ“ å¦‚æœ‰é—®é¢˜

å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. **API Key æ˜¯å¦æ­£ç¡®é…ç½®**
   ```bash
   cat .env | grep GEMINI
   ```

2. **æ•°æ®åº“æ˜¯å¦åŒæ­¥**
   ```bash
   npx prisma db push
   ```

3. **ä¾èµ–æ˜¯å¦å®‰è£…**
   ```bash
   npm install
   ```

4. **æŸ¥çœ‹æ—¥å¿—**
   - æ–‡æ¡ˆä¼˜åŒ–: æŸ¥æ‰¾ "ğŸ“ å‘é€æ–‡æ¡ˆä¼˜åŒ–è¯·æ±‚"
   - å›¾ç‰‡åˆ†æ: æŸ¥æ‰¾ "ğŸ” å‘é€å›¾ç‰‡åˆ†æè¯·æ±‚"
   - å›¾ç‰‡ç”Ÿæˆ: æŸ¥æ‰¾ "ğŸ¨ ä½¿ç”¨ Imagen 3 ç”Ÿæˆ"

---

## ğŸ‰ æ€»ç»“

æ‰€æœ‰åŠŸèƒ½å·²ç»å®Œæˆå¹¶å‡†å¤‡å°±ç»ªï¼š

âœ… æµç¨‹ 1: æ–‡æ¡ˆé€šè¿‡ Gemini 2.5 Pro è¿›è¡ŒäºŒåˆ›ä¼˜åŒ–
âœ… æµç¨‹ 2: å›¾ç‰‡é€šè¿‡ Gemini 2.5 Pro åˆ†æå¹¶ç”Ÿæˆæç¤ºè¯
âœ… æµç¨‹ 3: ä½¿ç”¨åˆ†ææç¤ºè¯ + åŸå›¾é€šè¿‡ Imagen 3 ç”Ÿæˆæ–°å›¾ç‰‡

**æ‚¨ç°åœ¨å¯ä»¥å¼€å§‹ä½¿ç”¨å®Œæ•´çš„å°çº¢ä¹¦äºŒåˆ›åŠŸèƒ½äº†ï¼** ğŸš€
